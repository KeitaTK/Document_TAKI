å‰ã®ä¼šè©±å±¥æ­´ã§ã®çµŒé¨“ã‚’è¸ã¾ãˆã€ç¦äº•å¤§å­¦ã®WSL2 Ubuntuç’°å¢ƒã§ArduPilotã®å®Œå…¨ãªãƒ“ãƒ«ãƒ‰ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®çµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚

# ArduPiloté–‹ç™ºç’°å¢ƒå®Œå…¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

## **ãƒ¡ã‚¤ãƒ³ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**

```bash
#!/bin/bash
# ArduPiloté–‹ç™ºç’°å¢ƒå®Œå…¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# å¯¾è±¡: WSL2 Ubuntu 24.04 @ ç¦äº•å¤§å­¦
# ä½œæˆè€…: å‰ã®ä¼šè©±å±¥æ­´ã‚’åŸºã«çµ±åˆ

set -e  # ã‚¨ãƒ©ãƒ¼æ™‚ã«åœæ­¢

echo "======================================"
echo "ArduPiloté–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–‹å§‹"
echo "å¯¾è±¡: WSL2 Ubuntu 24.04 @ ç¦äº•å¤§å­¦"
echo "======================================"

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š
WORK_DIR="$HOME/UMEMOTO2"
VENV_NAME="venv_ardupilot"
ARDUPILOT_DIR="$WORK_DIR/ardupilot"

# é–¢æ•°å®šç¾©
setup_proxy() {
    echo "## ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’è¿½åŠ ä¸­..."
    
    # ~/.bashrcã«ãƒ—ãƒ­ã‚­ã‚·é–¢æ•°ã‚’è¿½åŠ 
    cat >> ~/.bashrc /dev/null
  git config --global https.proxy "$https_proxy" 2>/dev/null

  # pipã®ãƒ—ãƒ­ã‚­ã‚·è¨­å®š
  mkdir -p ~/.config/pip
  cat > ~/.config/pip/pip.conf  /etc/apt/apt.conf.d/95proxies  ~/.wgetrc  ~/.curlrc  ~/.condarc /dev/null
  git config --global --unset https.proxy 2>/dev/null
  rm -f ~/.config/pip/pip.conf
  sudo rm -f /etc/apt/apt.conf.d/95proxies
  rm -f ~/.wgetrc ~/.curlrc ~/.condarc
  
  echo "ðŸš« ãƒ—ãƒ­ã‚­ã‚·ã‚’ç„¡åŠ¹ã«ã—ã¾ã—ãŸ"
}

function proxy_status() {
  if [ -n "$http_proxy" ]; then
    echo "âœ… ãƒ—ãƒ­ã‚­ã‚·ãŒæœ‰åŠ¹: $http_proxy"
  else
    echo "ðŸš« ãƒ—ãƒ­ã‚­ã‚·ãŒç„¡åŠ¹"
  fi
}

# ArduPiloté–‹ç™ºç”¨ã‚¨ã‚¤ãƒªã‚¢ã‚¹
alias ardupilot='cd ~/UMEMOTO2/ardupilot && source ../venv_ardupilot/bin/activate'
alias sitl_copter='cd ~/UMEMOTO2/ardupilot/ArduCopter && sim_vehicle.py --console --map'
alias sitl_plane='cd ~/UMEMOTO2/ardupilot/ArduPlane && sim_vehicle.py --console --map'

EOF

    echo "âœ… ãƒ—ãƒ­ã‚­ã‚·è¨­å®šé–¢æ•°ã‚’~/.bashrcã«è¿½åŠ å®Œäº†"
}

install_system_dependencies() {
    echo "## ã‚·ã‚¹ãƒ†ãƒ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
    
    # ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’æœ‰åŠ¹åŒ–
    source ~/.bashrc
    proxy_on
    
    # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    sudo apt update
    
    # åŸºæœ¬çš„ãªé–‹ç™ºãƒ„ãƒ¼ãƒ«
    sudo apt install -y \
        git \
        build-essential \
        cmake \
        python3 \
        python3-pip \
        python3-dev \
        python3-virtualenv \
        python-is-python3
    
    # ArduPilotå›ºæœ‰ã®ä¾å­˜é–¢ä¿‚
    sudo apt install -y \
        gcc-arm-none-eabi \
        libnewlib-arm-none-eabi \
        ccache \
        g++ \
        gawk \
        make \
        wget \
        rsync
    
    # ä¸è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å‰Šé™¤
    sudo apt autoremove -y
    
    echo "âœ… ã‚·ã‚¹ãƒ†ãƒ ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†"
}

setup_virtual_environment() {
    echo "## Pythonä»®æƒ³ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
    
    # ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
    mkdir -p "$WORK_DIR"
    cd "$WORK_DIR"
    
    # æ—¢å­˜ã®ä»®æƒ³ç’°å¢ƒã‚’å‰Šé™¤
    if [ -d "$VENV_NAME" ]; then
        echo "æ—¢å­˜ã®ä»®æƒ³ç’°å¢ƒã‚’å‰Šé™¤ä¸­..."
        rm -rf "$VENV_NAME"
    fi
    
    # Ubuntu 24.04å¯¾å¿œ: virtualenvã‚’ä½¿ç”¨
    echo "virtualenvã§ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆä¸­..."
    virtualenv "$VENV_NAME"
    
    # ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–
    source "$VENV_NAME/bin/activate"
    
    # pipã€setuptoolsã€wheelã‚’æœ€æ–°ç‰ˆã«æ›´æ–°
    pip install --upgrade pip setuptools wheel
    
    # ArduPilotã«å¿…è¦ãªPythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    echo "ArduPilotç”¨Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
    pip install empy==3.3.4
    pip install dronecan
    pip install pexpect
    pip install pymavlink
    pip install matplotlib
    pip install numpy
    pip install scipy
    
    echo "âœ… Pythonä»®æƒ³ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†"
}

clone_ardupilot() {
    echo "## ArduPilotã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ä¸­..."
    
    cd "$WORK_DIR"
    
    # æ—¢å­˜ã®ArduPilotãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤
    if [ -d "ardupilot" ]; then
        echo "æ—¢å­˜ã®ArduPilotãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ä¸­..."
        rm -rf ardupilot
    fi
    
    # ArduPilotã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
    echo "GitHubã‹ã‚‰ArduPilotã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ä¸­... (æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™)"
    git clone https://github.com/ArduPilot/ardupilot.git
    cd ardupilot
    
    # ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–
    echo "ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ä¸­... (ã•ã‚‰ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™)"
    git submodule update --init --recursive
    
    echo "âœ… ArduPilotã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚¯ãƒ­ãƒ¼ãƒ³å®Œäº†"
}

run_ardupilot_setup() {
    echo "## ArduPilotå…¬å¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œä¸­..."
    
    cd "$ARDUPILOT_DIR"
    
    # ä»®æƒ³ç’°å¢ƒã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ–
    deactivate
    
    # ArduPilotå…¬å¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
    Tools/environment_install/install-prereqs-ubuntu.sh -y
    
    # ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†èª­ã¿è¾¼ã¿
    source ~/.profile
    
    # ä»®æƒ³ç’°å¢ƒã‚’å†åº¦æœ‰åŠ¹åŒ–
    source "../$VENV_NAME/bin/activate"
    
    echo "âœ… ArduPilotå…¬å¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œå®Œäº†"
}

configure_and_test_build() {
    echo "## ãƒ“ãƒ«ãƒ‰è¨­å®šã¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­..."
    
    cd "$ARDUPILOT_DIR"
    source "../$VENV_NAME/bin/activate"
    
    # Pixhawk6Cå‘ã‘ã«è¨­å®š
    echo "Pixhawk6Cå‘ã‘ã«ãƒ“ãƒ«ãƒ‰è¨­å®šä¸­..."
    ./waf configure --board Pixhawk6C
    
    # ãƒ†ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
    echo "ãƒ†ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œä¸­..."
    ./waf copter
    
    echo "âœ… ãƒ“ãƒ«ãƒ‰è¨­å®šã¨ãƒ†ã‚¹ãƒˆå®Œäº†"
}

create_usage_guide() {
    echo "## ä½¿ç”¨æ–¹æ³•ã‚¬ã‚¤ãƒ‰ã‚’ä½œæˆä¸­..."
    
    cat > "$WORK_DIR/USAGE_GUIDE.md" << 'EOF'
# ArduPiloté–‹ç™ºç’°å¢ƒä½¿ç”¨ã‚¬ã‚¤ãƒ‰

## æ¯Žå›žã®é–‹ç™ºé–‹å§‹æ‰‹é †

```
# 1. ãƒ—ãƒ­ã‚­ã‚·æœ‰åŠ¹åŒ–
proxy_on

# 2. ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ~/UMEMOTO2

# 3. ä»®æƒ³ç’°å¢ƒæœ‰åŠ¹åŒ–
source venv_ardupilot/bin/activate

# 4. ArduPilotãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ardupilot
```

## ä¾¿åˆ©ãªã‚¨ã‚¤ãƒªã‚¢ã‚¹

```
# ArduPilotç’°å¢ƒã¸ã®ç§»å‹•ã¨ä»®æƒ³ç’°å¢ƒæœ‰åŠ¹åŒ–
ardupilot

# SITLã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼èµ·å‹•
sitl_copter  # ãƒžãƒ«ãƒã‚³ãƒ—ã‚¿ãƒ¼
sitl_plane   # å›ºå®šç¿¼æ©Ÿ
```

## ã‚ˆãä½¿ã†ã‚³ãƒžãƒ³ãƒ‰

```
# ãƒ“ãƒ«ãƒ‰è¨­å®š
./waf configure --board Pixhawk6C

# ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
./waf copter    # ãƒžãƒ«ãƒã‚³ãƒ—ã‚¿ãƒ¼
./waf plane     # å›ºå®šç¿¼æ©Ÿ
./waf rover     # åœ°ä¸Šè»Šä¸¡

# ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰
./waf clean
./waf configure --board Pixhawk6C
./waf copter

# SITLã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼
cd ArduCopter
sim_vehicle.py --console --map
```

## ãƒ—ãƒ­ã‚­ã‚·ç®¡ç†

```
proxy_on      # ãƒ—ãƒ­ã‚­ã‚·æœ‰åŠ¹åŒ–
proxy_off     # ãƒ—ãƒ­ã‚­ã‚·ç„¡åŠ¹åŒ–
proxy_status  # ãƒ—ãƒ­ã‚­ã‚·çŠ¶æ…‹ç¢ºèª
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
```
./waf clean
git submodule update --init --recursive
./waf configure --board Pixhawk6C
./waf copter
```

### ãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
```
proxy_off
proxy_on
proxy_status
```
EOF

    echo "âœ… ä½¿ç”¨æ–¹æ³•ã‚¬ã‚¤ãƒ‰ä½œæˆå®Œäº†: $WORK_DIR/USAGE_GUIDE.md"
}

# ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
main() {
    echo "ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’é–‹å§‹ã—ã¾ã™..."
    
    setup_proxy
    source ~/.bashrc  # ãƒ—ãƒ­ã‚­ã‚·é–¢æ•°ã‚’èª­ã¿è¾¼ã¿
    
    install_system_dependencies
    setup_virtual_environment
    clone_ardupilot
    run_ardupilot_setup
    configure_and_test_build
    create_usage_guide
    
    echo ""
    echo "======================================"
    echo "ðŸŽ‰ ArduPiloté–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†!"
    echo "======================================"
    echo ""
    echo "æ¬¡å›žã‹ã‚‰ã®ä½¿ç”¨æ–¹æ³•:"
    echo "1. proxy_on"
    echo "2. cd ~/UMEMOTO2"
    echo "3. source venv_ardupilot/bin/activate"
    echo "4. cd ardupilot"
    echo ""
    echo "ã¾ãŸã¯ç°¡å˜ã«: ardupilot"
    echo ""
    echo "è©³ç´°ã¯ $WORK_DIR/USAGE_GUIDE.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„"
}

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
main "$@"
```

## **ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ–¹æ³•**

### **1. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**

```bash
# ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
cd ~
nano setup_ardupilot.sh
```

ä¸Šè¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…å®¹ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚

### **2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹**

```bash
chmod +x setup_ardupilot.sh
```

### **3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ**

```bash
./setup_ardupilot.sh
```

## **ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¸»ãªç‰¹å¾´**

### **âœ… å‰ã®ä¼šè©±ã§è§£æ±ºã—ãŸå•é¡Œã¸ã®å¯¾å¿œ**
- **Ubuntu 24.04ã®PEP 668åˆ¶é™**: `virtualenv`ã‚’ä½¿ç”¨
- **ç¦äº•å¤§å­¦ãƒ—ãƒ­ã‚­ã‚·ç’°å¢ƒ**: åŒ…æ‹¬çš„ãªãƒ—ãƒ­ã‚­ã‚·è¨­å®šé–¢æ•°
- **ä¾å­˜é–¢ä¿‚ã®ç«¶åˆ**: ç‰¹å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šï¼ˆ`empy==3.3.4`ï¼‰
- **ARMç’°å¢ƒ**: `gcc-arm-none-eabi`ã®è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### **âœ… çµ±åˆã•ã‚ŒãŸæ©Ÿèƒ½**
- **ã‚·ã‚¹ãƒ†ãƒ ä¾å­˜é–¢ä¿‚**: APTãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¸€æ‹¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- **Pythonä»®æƒ³ç’°å¢ƒ**: ç¢ºå®Ÿãªç’°å¢ƒåˆ†é›¢
- **ArduPilotã‚¯ãƒ­ãƒ¼ãƒ³**: ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å«ã‚€å®Œå…¨å–å¾—
- **å…¬å¼ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: `install-prereqs-ubuntu.sh`ã®å®Ÿè¡Œ
- **ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ**: Pixhawk6Cå‘ã‘ã®å‹•ä½œç¢ºèª

### **âœ… ä½¿ã„ã‚„ã™ã•ã®å‘ä¸Š**
- **ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®š**: `ardupilot`ã€`sitl_copter`ãªã©
- **ä½¿ç”¨æ–¹æ³•ã‚¬ã‚¤ãƒ‰**: `USAGE_GUIDE.md`ã®è‡ªå‹•ç”Ÿæˆ
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: `set -e`ã§åœæ­¢å‡¦ç†

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã‚Šã€å‰ã®ä¼šè©±ã§è“„ç©ã•ã‚ŒãŸã™ã¹ã¦ã®çŸ¥è¦‹ãŒçµ±åˆã•ã‚Œã€ç¦äº•å¤§å­¦ã®WSL2ç’°å¢ƒã§ArduPilotã®å®Œå…¨ãªé–‹ç™ºç’°å¢ƒã‚’ä¸€åº¦ã«æ§‹ç¯‰ã§ãã¾ã™ã€‚

[1] https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark@2x.png
